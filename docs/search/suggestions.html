<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><title>Elastic4s</title><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="Elasticsearch Scala Client" /><meta name="author" content="Stephen Samuel" /><meta name="og:image" content="/elastic4s/img/poster.png" /><meta name="og:title" content="Elastic4s" /><meta name="og:site_name" content="Elastic4s" /><meta name="og:url" content="https://sksamuel.github.io/elastic4s" /><meta name="og:type" content="website" /><meta name="og:description" content="Elasticsearch Scala Client" /><meta name="twitter:image" content="/elastic4s/img/poster.png" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="" /><link rel="icon" type="image/png" href="/elastic4s/img/favicon.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/elastic4s/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/elastic4s/css/style.css" /><link rel="stylesheet" href="/elastic4s/css/palette.css" /><link rel="stylesheet" href="/elastic4s/css/override.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/elastic4s/" class="brand"><div class="brand-wrapper" style="background:url('/elastic4s/img/sidebar_brand.png') no-repeat"><span>Elastic4s</span></div></a></li> <li><a href="/elastic4s/docs/index.html" class="">Getting Started</a></li> <li><a href="/elastic4s/docs/document/index.html" class="">Document API</a> <ul class="sub_section"> <li><a href="/elastic4s/docs/document/index.html" class="">Index</a></li> <li><a href="/elastic4s/docs/document/get.html" class="">Get</a></li> <li><a href="/elastic4s/docs/document/multiget.html" class="">Multi Get</a></li> <li><a href="/elastic4s/docs/document/delete.html" class="">Delete</a></li> <li><a href="/elastic4s/docs/document/update.html" class="">Update</a></li> <li><a href="/elastic4s/docs/document/bulk.html" class="">Bulk</a></li></ul></li> <li><a href="/elastic4s/docs/search/search.html" class="">Search API</a> <ul class="sub_section"> <li><a href="/elastic4s/docs/search/multisearch.html" class="">Multi Search</a></li> <li><a href="/elastic4s/docs/search/explain.html" class="">Explain</a></li> <li><a href="/elastic4s/docs/search/suggestions.html" class="">Suggestions</a></li> <li><a href="/elastic4s/docs/search/validate.html" class="">Validate</a></li> <li><a href="/elastic4s/docs/search/count.html" class="">Count</a></li></ul></li> <li><a href="/elastic4s/docs/indices/createindex.html" class="">Indices API</a> <ul class="sub_section"> <li><a href="/elastic4s/docs/indices/createindex.html" class="">Create Index</a></li> <li><a href="/elastic4s/docs/indices/aliases.html" class="">Aliases</a></li> <li><a href="/elastic4s/docs/indices/optimize.html" class="">Optimize</a></li></ul></li> <li><a href="/elastic4s/docs/misc/analyzers.html" class="">Analyzers</a></li> <li><a href="/elastic4s/docs/misc/snapshot.html" class="">Snapshot</a></li> <li><a href="/elastic4s/docs/misc/javainterop.html" class="">Java Interop</a></li> <li><a href="/elastic4s/api/index.html" class="">Scaladoc</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="hidden-xs"><a href="https://github.com/sksamuel/elastic4s"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li class="hidden-xs"><a href="https://github.com/sksamuel/elastic4s"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Elastic4s Elasticsearch Scala Client');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Elastic4s Elasticsearch Scala Client');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="sksamuel" data-github-repo="elastic4s"><div class="content-wrapper"><section><h1 id="suggestions">Suggestions</h1>

<p>The suggestions feature returns similar looking terms (suggestions) for some given text using a suggestor. Suggestions
can be specified as part of a search query.</p>

<p>We can ask elasticsearch to include suggestions by adding a <code class="highlighter-rouge">suggestions</code> block to the search query. Inside the suggestions block 
we add suggestion entries, of type <code class="highlighter-rouge">term</code>, <code class="highlighter-rouge">fuzzyCompletion</code>, <code class="highlighter-rouge">completion</code>, or <code class="highlighter-rouge">phrase</code>.</p>

<p>You can have multiple suggestions (for different fields say, or different types) in a search query, so each suggestion<br />
 needs a name, which is used to refer to it later. Elastic4s also allows you to look up the suggestion response from the original 
 suggestion class, which is the preferred way as it also avoids some casting you would otherwise need to do.</p>

<h2 id="term-suggestion">Term Suggestion</h2>

<p>The term suggestor looks for terms in the index that are closest to the input.
Let’s start by creating an index with some data.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span>
  <span class="n">bulk</span><span class="o">(</span>
    <span class="n">index</span> <span class="n">into</span> <span class="n">indexType</span> <span class="n">source</span> <span class="nc">Song</span><span class="o">(</span><span class="s">"style"</span><span class="o">,</span> <span class="s">"taylor swift"</span><span class="o">),</span>
    <span class="n">index</span> <span class="n">into</span> <span class="n">indexType</span> <span class="n">source</span> <span class="nc">Song</span><span class="o">(</span><span class="s">"shake it off"</span><span class="o">,</span> <span class="s">"Taylor Swift"</span><span class="o">),</span>
    <span class="n">index</span> <span class="n">into</span> <span class="n">indexType</span> <span class="n">source</span> <span class="nc">Song</span><span class="o">(</span><span class="s">"a new england"</span><span class="o">,</span> <span class="s">"kirsty maccoll"</span><span class="o">),</span>
    <span class="n">index</span> <span class="n">into</span> <span class="n">indexType</span> <span class="n">source</span> <span class="nc">Song</span><span class="o">(</span><span class="s">"blank page"</span><span class="o">,</span> <span class="s">"taylor swift"</span><span class="o">),</span>
    <span class="n">index</span> <span class="n">into</span> <span class="n">indexType</span> <span class="n">source</span> <span class="nc">Song</span><span class="o">(</span><span class="s">"I want it all"</span><span class="o">,</span> <span class="s">"Queen"</span><span class="o">),</span>
    <span class="n">index</span> <span class="n">into</span> <span class="n">indexType</span> <span class="n">source</span> <span class="nc">Song</span><span class="o">(</span><span class="s">"I to break free"</span><span class="o">,</span> <span class="s">"Queen"</span><span class="o">),</span>
    <span class="n">index</span> <span class="n">into</span> <span class="n">indexType</span> <span class="n">source</span> <span class="nc">Song</span><span class="o">(</span><span class="s">"radio gaga"</span><span class="o">,</span> <span class="s">"Queen"</span><span class="o">),</span>
    <span class="n">index</span> <span class="n">into</span> <span class="n">indexType</span> <span class="n">source</span> <span class="nc">Song</span><span class="o">(</span><span class="s">"we are the champions"</span><span class="o">,</span> <span class="s">"Quoon"</span><span class="o">),</span>
    <span class="n">index</span> <span class="n">into</span> <span class="n">indexType</span> <span class="n">source</span> <span class="nc">Song</span><span class="o">(</span><span class="s">"Down with the trumpets"</span><span class="o">,</span> <span class="s">"Rizzle Kicks"</span><span class="o">),</span>
    <span class="n">index</span> <span class="n">into</span> <span class="n">indexType</span> <span class="n">source</span> <span class="nc">Song</span><span class="o">(</span><span class="s">"Down with the trombones"</span><span class="o">,</span> <span class="s">"Razzle Kacks"</span><span class="o">),</span>
    <span class="n">index</span> <span class="n">into</span> <span class="n">indexType</span> <span class="n">source</span> <span class="nc">Song</span><span class="o">(</span><span class="s">"lover of the light"</span><span class="o">,</span> <span class="s">"Mumford and sons"</span><span class="o">),</span>
    <span class="n">index</span> <span class="n">into</span> <span class="n">indexType</span> <span class="n">source</span> <span class="nc">Song</span><span class="o">(</span><span class="s">"Monster"</span><span class="o">,</span> <span class="s">"Mumford and sons"</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">).</span><span class="n">await</span> <span class="c1">// as always the await is just used to block in demo code
</span></code></pre>
</div>

<p>Now we can add a suggestion block that will work with the data above.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">mysugg</span> <span class="k">=</span> <span class="n">termSuggestion</span><span class="o">(</span><span class="s">"mysugg"</span><span class="o">).</span><span class="n">field</span><span class="o">(</span><span class="s">"artist"</span><span class="o">).</span><span class="n">text</span><span class="o">(</span><span class="s">"taylor swaft"</span><span class="o">)</span>

<span class="k">val</span> <span class="n">resp</span> <span class="k">=</span> <span class="n">client</span><span class="o">.</span><span class="n">execute</span> <span class="o">{</span>
  <span class="n">search</span> <span class="n">in</span> <span class="n">indexType</span> <span class="n">suggestions</span> <span class="o">{</span>
    <span class="n">mysugg</span>
  <span class="o">}</span>
<span class="o">}.</span><span class="n">await</span>

<span class="c1">// use the suggestion def created earlier to retrieve the suggestion response
</span><span class="n">resp</span><span class="o">.</span><span class="n">suggestion</span><span class="o">(</span><span class="n">mysugg</span><span class="o">).</span><span class="n">entry</span><span class="o">(</span><span class="s">"taylor"</span><span class="o">).</span><span class="n">options</span> <span class="c1">// is empty
</span><span class="n">resp</span><span class="o">.</span><span class="n">suggestion</span><span class="o">(</span><span class="n">mysugg</span><span class="o">).</span><span class="n">entry</span><span class="o">(</span><span class="s">"swaft"</span><span class="o">).</span><span class="n">options</span> <span class="c1">// contains ["swift"]
</span></code></pre>
</div>

<p>In the suggestion response are entries, where each entry refers to a term in the text supplied. So in that example, 
the text was “taylor swaft” which will become two terms, “taylor” and “swaft” so the suggestion response also has
two entries. The options array is the actual suggested terms for the entry.</p>

<p>You will notice that the first time, “taylor”, has no options. This is because it actually had a match, so by default
elasticsearch skips it. You can force suggestions even when the term matches by changing the mode:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">mysugg</span> <span class="k">=</span> <span class="n">termSuggestion</span><span class="o">(</span><span class="s">"mysugg"</span><span class="o">).</span><span class="n">field</span><span class="o">(</span><span class="s">"artist"</span><span class="o">).</span><span class="n">text</span><span class="o">(</span><span class="s">"taylor swaft"</span><span class="o">).</span><span class="n">mode</span><span class="o">(</span><span class="nc">SuggestMode</span><span class="o">.</span><span class="nc">Always</span><span class="o">)</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">SuggestMode.Always</code> means always include suggestions, and SuggestMode.Popular means include suggestions if there were
more popular results than the ones that matched.</p>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/elastic4s/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="/elastic4s/js/main.js"></script></body></html>